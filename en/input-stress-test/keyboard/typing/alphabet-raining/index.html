<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”®ç›˜å°è‹±é›„ - å„¿ç«¥æ‰“å­—æ¸¸æˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Varela+Round&display=swap');

        :root {
            --bg-top: #845EC2;
            --bg-bottom: #D65DB1;
            --uibg: rgba(255, 255, 255, 0.9);
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Fredoka One', cursive;
            background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
            height: 100vh;
            color: #333;
            user-select: none;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        #game-area {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* æ‰è½çš„ç‰©ä½“ */
        .falling-item {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            text-align: center;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.2);
            border: 4px solid #fff;
            transition: transform 0.1s;
            z-index: 10;
        }

        .falling-item.shake {
            animation: shake 0.3s;
            border-color: #FF6B6B;
            background: #FFEBEE;
        }

        @keyframes shake {
            0% { transform: translateX(-55%); }
            25% { transform: translateX(-45%); }
            50% { transform: translateX(-55%); }
            75% { transform: translateX(-45%); }
            100% { transform: translateX(-50%); }
        }

        .item-emoji { font-size: 3rem; display: block; margin-bottom: 5px; }
        .item-word { font-size: 2rem; letter-spacing: 3px; color: #ccc; }
        
        /* å·²è¾“å…¥çš„å­—ç¬¦æ ·å¼ */
        .typed-char { color: #4CAF50; text-shadow: 0 2px 0 #A5D6A7; }
        .current-char { text-decoration: underline; text-decoration-color: #FF9800; text-decoration-thickness: 4px;}

        /* åœ°é¢ */
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: #00C9A7;
            border-top: 8px solid #009E83;
            z-index: 20;
        }

        /* UI é¢æ¿ */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 30;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€ */
        }

        .hud-box {
            background: var(--uibg);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
            font-size: 1.5rem;
            color: #845EC2;
        }

        /* å¼€å§‹/ç»“æŸ å¼¹çª— */
        #menu-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .menu-box {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: bounceIn 0.5s;
        }

        .btn {
            background: #FF9800;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Fredoka One';
            margin: 10px;
            box-shadow: 0 6px 0 #E65100;
            transition: transform 0.1s;
        }
        .btn:active { transform: translateY(6px); box-shadow: none; }
        .btn-green { background: #4CAF50; box-shadow: 0 6px 0 #2E7D32; }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* çˆ†ç‚¸ç‰¹æ•ˆ */
        .particle {
            position: absolute;
            width: 10px; height: 10px;
            border-radius: 50%;
            animation: pop 0.8s forwards;
        }
        @keyframes pop {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        .mode-select { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .mode-opt {
            padding: 10px 20px; border: 2px solid #ddd; border-radius: 15px; cursor: pointer; color: #888;
        }
        .mode-opt.selected { background: #E1F5FE; border-color: #29B6F6; color: #0277BD; }

    </style>
</head>
<body>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-area">
        <div id="ui-layer">
            <div class="hud-box">â¤ï¸ <span id="lives">5</span></div>
            <div class="hud-box">â­ <span id="score">0</span></div>
        </div>
        
        <!-- å•è¯ç”Ÿæˆå®¹å™¨ -->
        <div id="items-container"></div>
        
        <div class="ground"></div>
    </div>

    <!-- èœå•å±‚ -->
    <div id="menu-overlay">
        <div class="menu-box">
            <h1 style="font-size: 3rem; margin: 0 0 20px 0; color:#845EC2;">Typing Hero</h1>
            <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ¹</div>
            
            <div class="mode-select">
                <div class="mode-opt selected" id="opt-easy" onclick="selectMode('easy')">ğŸ‘¶ å­—æ¯ç»ƒä¹  (ç®€å•)</div>
                <div class="mode-opt" id="opt-hard" onclick="selectMode('hard')">ğŸ¦ å•è¯æŒ‘æˆ˜ (å›°éš¾)</div>
            </div>

            <p id="final-score-display" style="display:none; color:#FF6B6B; font-size:1.5rem;">Score: 0</p>
            <button class="btn btn-green" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <!-- éŸ³æ•ˆ (ä½¿ç”¨ AudioContext ç”Ÿæˆï¼Œè¿™é‡Œä¸ºäº†ç®€å•ä½¿ç”¨ TTS) -->

    <script>
        // --- 1. è¯åº“é…ç½® ---
        const wordsDB = {
            easy: [ // å•ä¸ªå­—æ¯
                {t:"A",e:"ğŸ…°ï¸"},{t:"B",e:"ğŸ…±ï¸"},{t:"C",e:"Â©ï¸"},{t:"D",e:"ğŸ‡©"},{t:"E",e:"ğŸ‡ª"},
                {t:"F",e:"ğŸ‡«"},{t:"G",e:"ğŸ‡¬"},{t:"H",e:"ğŸ‡­"},{t:"I",e:"â„¹ï¸"},{t:"J",e:"ğŸ‡¯"},
                {t:"K",e:"ğŸ‡°"},{t:"L",e:"ğŸ‡±"},{t:"M",e:"â“‚ï¸"},{t:"N",e:"ğŸ‡³"},{t:"O",e:"â­•"},
                {t:"P",e:"ğŸ…¿ï¸"},{t:"Q",e:"ğŸ‡¶"},{t:"R",e:"Â®ï¸"},{t:"S",e:"ğŸ‡¸"},{t:"T",e:"âœï¸"},
                {t:"U",e:"â›"},{t:"V",e:"âœŒï¸"},{t:"W",e:"ğŸ‡¼"},{t:"X",e:"âŒ"},{t:"Y",e:"ğŸ‡¾"},{t:"Z",e:"ğŸ’¤"}
            ],
            hard: [ // å®Œæ•´å•è¯ (å¤ç”¨ä¹‹å‰çš„è¯åº“)
                {t:"CAT",e:"ğŸ±"},{t:"DOG",e:"ğŸ¶"},{t:"PIG",e:"ğŸ·"},{t:"FOX",e:"ğŸ¦Š"},
                {t:"LION",e:"ğŸ¦"},{t:"BEAR",e:"ğŸ»"},{t:"DUCK",e:"ğŸ¦†"},{t:"FROG",e:"ğŸ¸"},
                {t:"FISH",e:"ğŸŸ"},{t:"BIRD",e:"ğŸ¦"},{t:"APPLE",e:"ğŸ"},{t:"PEAR",e:"ğŸ"},
                {t:"EGG",e:"ğŸ¥š"},{t:"MILK",e:"ğŸ¥›"},{t:"CAR",e:"ğŸš—"},{t:"BUS",e:"ğŸšŒ"},
                {t:"RED",e:"â¤ï¸"},{t:"BLUE",e:"ğŸ’™"},{t:"ONE",e:"1ï¸âƒ£"},{t:"TWO",e:"2ï¸âƒ£"}
            ]
        };

        // --- 2. æ¸¸æˆçŠ¶æ€ ---
        let state = {
            playing: false,
            score: 0,
            lives: 5,
            mode: 'easy',
            speed: 1.5, // æ‰è½é€Ÿåº¦ (px/frame)
            spawnRate: 2000, // ç”Ÿæˆé—´éš” (ms)
            activeItem: null, // å½“å‰æ­£åœ¨æ‰“çš„å•è¯å¯¹è±¡
            items: [], // å±å¹•ä¸Šçš„æ‰€æœ‰å•è¯
            lastSpawnTime: 0
        };

        let animationFrameId;

        // --- 3. æ ¸å¿ƒé€»è¾‘ ---

        function selectMode(m) {
            state.mode = m;
            document.querySelectorAll('.mode-opt').forEach(el => el.classList.remove('selected'));
            document.getElementById('opt-'+m).classList.add('selected');
        }

        function startGame() {
            // é‡ç½®çŠ¶æ€
            state.playing = true;
            state.score = 0;
            state.lives = 5;
            state.speed = state.mode === 'easy' ? 1 : 1.5; // å›°éš¾æ¨¡å¼æ‰è½æ›´å¿«
            state.spawnRate = state.mode === 'easy' ? 2500 : 2000;
            state.items = [];
            state.activeItem = null;
            
            // UI é‡ç½®
            document.getElementById('score').innerText = 0;
            document.getElementById('lives').innerText = 5;
            document.getElementById('items-container').innerHTML = '';
            document.getElementById('menu-overlay').style.display = 'none';
            document.getElementById('final-score-display').style.display = 'none';

            // å¯åŠ¨å¾ªç¯
            state.lastSpawnTime = performance.now();
            loop();
        }

        function loop(timestamp) {
            if (!state.playing) return;

            // 1. ç”Ÿæˆæ–°å•è¯
            if (timestamp - state.lastSpawnTime > state.spawnRate) {
                spawnItem();
                state.lastSpawnTime = timestamp;
                // éšç€åˆ†æ•°å¢åŠ ï¼Œéš¾åº¦å¾®å¢
                if(state.spawnRate > 1000) state.spawnRate -= 20; 
            }

            // 2. ç§»åŠ¨å•è¯
            updateItems();

            animationFrameId = requestAnimationFrame(loop);
        }

        function spawnItem() {
            const db = wordsDB[state.mode];
            const data = db[Math.floor(Math.random() * db.length)];
            
            const el = document.createElement('div');
            el.className = 'falling-item';
            // éšæœºæ¨ªå‘ä½ç½® (10% - 90%)
            el.style.left = (10 + Math.random() * 80) + '%';
            el.style.top = '-150px'; // åˆå§‹é«˜åº¦
            
            // æ¸²æŸ“å†…å®¹
            let htmlHTML = `<span class="item-emoji">${data.e}</span><div class="item-word">`;
            for(let char of data.t) {
                htmlHTML += `<span>${char}</span>`;
            }
            htmlHTML += `</div>`;
            el.innerHTML = htmlHTML;

            document.getElementById('items-container').appendChild(el);

            state.items.push({
                el: el,
                text: data.t, // å®Œæ•´å•è¯
                typedIndex: 0, // å·²æ‰“äº†å‡ ä¸ªå­—æ¯
                y: -150 // å½“å‰Yåæ ‡
            });
        }

        function updateItems() {
            const containerHeight = document.getElementById('game-area').offsetHeight;
            const groundLimit = containerHeight - 60; // åœ°é¢é«˜åº¦

            for (let i = state.items.length - 1; i >= 0; i--) {
                const item = state.items[i];
                item.y += state.speed;
                item.el.style.top = item.y + 'px';

                // è§¦åº•åˆ¤å®š
                if (item.y > groundLimit - 50) {
                    gameOverItem(i);
                }
            }
        }

        function gameOverItem(index) {
            const item = state.items[index];
            item.el.remove();
            state.items.splice(index, 1);
            
            // å¦‚æœæ­£æ˜¯å½“å‰é”å®šçš„å•è¯ï¼Œè§£é”
            if(state.activeItem === item) state.activeItem = null;

            // æ‰£è¡€
            state.lives--;
            document.getElementById('lives').innerText = state.lives;
            shakeScreen();
            playSound('wrong');

            if (state.lives <= 0) {
                endGame();
            }
        }

        function endGame() {
            state.playing = false;
            cancelAnimationFrame(animationFrameId);
            
            document.getElementById('menu-overlay').style.display = 'flex';
            document.querySelector('.menu-box h1').innerText = "Game Over!";
            const scoreDisplay = document.getElementById('final-score-display');
            scoreDisplay.style.display = 'block';
            scoreDisplay.innerText = "Final Score: " + state.score;
        }

        // --- 4. é”®ç›˜äº¤äº’ ---
        window.addEventListener('keydown', (e) => {
            if (!state.playing) return;
            
            const key = e.key.toUpperCase();
            // åªå“åº” A-Z
            if (!/^[A-Z]$/.test(key)) return;

            // ç­–ç•¥ï¼šå¦‚æœæ²¡æœ‰é”å®šç›®æ ‡ï¼Œå¯»æ‰¾å±å¹•ä¸Šæ‰€æœ‰å•è¯ä¸­ï¼Œé¦–å­—æ¯åŒ¹é…ä¸”ä½ç½®æœ€ä½ï¼ˆæœ€å±é™©ï¼‰çš„é‚£ä¸ª
            if (!state.activeItem) {
                // æ‰¾å‡ºæ‰€æœ‰é¦–å­—æ¯åŒ¹é…çš„
                let candidates = state.items.filter(it => it.text[0] === key);
                if (candidates.length > 0) {
                    // é€‰Yå€¼æœ€å¤§ï¼ˆæœ€ä¸‹é¢ï¼‰çš„é‚£ä¸ª
                    candidates.sort((a,b) => b.y - a.y);
                    state.activeItem = candidates[0];
                }
            }

            // å¤„ç†è¾“å…¥
            if (state.activeItem) {
                const targetChar = state.activeItem.text[state.activeItem.typedIndex];
                
                if (key === targetChar) {
                    // è¾“å…¥æ­£ç¡®
                    handleCorrectInput(state.activeItem);
                } else {
                    // è¾“å…¥é”™è¯¯
                    handleWrongInput(state.activeItem);
                }
            } else {
                // æŒ‰äº†é”®ç›˜ä½†æ²¡æœ‰åŒ¹é…çš„å•è¯
                playSound('wrong'); 
            }
        });

        function handleCorrectInput(item) {
            // è§†è§‰æ›´æ–°ï¼šå˜ç»¿
            const span = item.el.querySelectorAll('.item-word span')[item.typedIndex];
            span.className = 'typed-char';
            
            // æ’­æ”¾å­—æ¯éŸ³
            speak(item.text[item.typedIndex]);

            item.typedIndex++;

            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ•´ä¸ªå•è¯
            if (item.typedIndex >= item.text.length) {
                // å•è¯å®Œæˆï¼
                destroyItem(item);
            } else {
                // ç»™ä¸‹ä¸€ä¸ªå­—æ¯åŠ ä¸‹åˆ’çº¿æç¤º
                const nextSpan = item.el.querySelectorAll('.item-word span')[item.typedIndex];
                if(nextSpan) nextSpan.classList.add('current-char');
            }
        }

        function handleWrongInput(item) {
            item.el.classList.remove('shake');
            void item.el.offsetWidth; // å¼ºåˆ¶é‡ç»˜ä»¥è§¦å‘åŠ¨ç”»
            item.el.classList.add('shake');
            playSound('wrong');
        }

        function destroyItem(item) {
            // ç‰¹æ•ˆ
            createExplosion(item.el);
            speak(item.text); // è¯»å®Œæ•´å•è¯

            // ç§»é™¤ DOM å’Œ æ•°æ®
            item.el.remove();
            const idx = state.items.indexOf(item);
            if (idx > -1) state.items.splice(idx, 1);
            
            state.activeItem = null; // è§£é”

            // åŠ åˆ†
            state.score += 10;
            document.getElementById('score').innerText = state.score;
            
            // å¶å°”å¥–åŠ±ç”Ÿå‘½
            if(state.score > 0 && state.score % 200 === 0) {
                state.lives++;
                document.getElementById('lives').innerText = state.lives;
            }
        }

        // --- 5. è¾…åŠ©åŠŸèƒ½ ---

        // çˆ†ç‚¸ç²’å­ç‰¹æ•ˆ
        function createExplosion(el) {
            const rect = el.getBoundingClientRect();
            const colors = ['#FFD700', '#FF6B6B', '#4CAF50', '#29B6F6'];
            
            for(let i=0; i<15; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                p.style.left = (rect.left + rect.width/2) + 'px';
                p.style.top = (rect.top + rect.height/2) + 'px';
                
                // éšæœºé£æ•£æ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const dist = 50 + Math.random() * 100;
                p.style.setProperty('--tx', Math.cos(angle) * dist + 'px');
                p.style.setProperty('--ty', Math.sin(angle) * dist + 'px');
                
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        }

        function shakeScreen() {
            document.body.style.transform = "translateX(5px)";
            setTimeout(() => document.body.style.transform = "translateX(-5px)", 50);
            setTimeout(() => document.body.style.transform = "translateX(0)", 100);
        }

        // ç®€å•çš„éŸ³æ•ˆæ¨¡æ‹Ÿ
        function playSound(type) {
            // çœŸå®é¡¹ç›®ä¸­å»ºè®®åŠ è½½ mp3ï¼Œè¿™é‡Œç”¨é™éŸ³æˆ–ç®€å•é€»è¾‘ä»£æ›¿ï¼Œå› ä¸º Web Audio éœ€è¦ç”¨æˆ·äº¤äº’
        }

        // TTS å‘éŸ³
        function speak(text) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US';
            u.rate = 1.0;
            // å¦‚æœæ˜¯å•ä¸ªå­—æ¯ï¼Œç¨å¾®è¯»æ…¢ç‚¹æ¸…æ¥šç‚¹
            if(text.length === 1) u.rate = 0.8; 
            window.speechSynthesis.speak(u);
        }

    </script>
</body>
</html>